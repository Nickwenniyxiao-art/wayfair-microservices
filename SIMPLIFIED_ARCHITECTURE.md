# Wayfair Clone - 单商户电商平台架构

## 系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                    用户端 (Storefront)                           │
│  - 用户注册/登录                                                 │
│  - 浏览商品                                                      │
│  - 搜索和筛选                                                    │
│  - 加入购物车                                                    │
│  - 结账和支付                                                    │
│  - 订单管理                                                      │
│  - 用户账户管理                                                  │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        API Gateway                              │
│  - 请求路由                                                     │
│  - 认证和授权                                                   │
│  - 速率限制                                                     │
│  - 日志记录                                                     │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    后端微服务集群                                │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Auth Service │  │ User Service │  │Product Svc   │          │
│  │ - 用户认证   │  │ - 用户管理   │  │ - 商品管理   │          │
│  │ - 登录/注册  │  │ - 地址管理   │  │ - 库存管理   │          │
│  │ - JWT令牌    │  │ - 个人信息   │  │ - 分类管理   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Cart Service │  │Order Service │  │Payment Svc   │          │
│  │ - 购物车管理 │  │ - 订单创建   │  │ - Stripe集成 │          │
│  │ - 价格计算   │  │ - 订单追踪   │  │ - 支付处理   │          │
│  │ - 库存检查   │  │ - 状态管理   │  │ - 退款处理   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐                            │
│  │Shipping Svc  │  │ Return Svc   │                            │
│  │ - 配送管理   │  │ - 退货管理   │                            │
│  │ - 费用计算   │  │ - 退款处理   │                            │
│  │ - 追踪信息   │  │ - 退货追踪   │                            │
│  └──────────────┘  └──────────────┘                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    数据存储层                                    │
│  - MySQL 数据库                                                 │
│  - Redis 缓存                                                   │
│  - S3 文件存储                                                  │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                  管理后台 (Admin Dashboard)                      │
│  - 商品管理（上传、编辑、删除）                                 │
│  - 库存管理                                                     │
│  - 订单管理                                                     │
│  - 销售统计                                                     │
│  - 用户管理                                                     │
│  - 系统设置                                                     │
└─────────────────────────────────────────────────────────────────┘
```

## 核心模块清单

### 1. 认证和授权 (Authentication & Authorization)
- [ ] 用户注册
- [ ] 用户登录
- [ ] JWT 令牌管理
- [ ] 权限验证
- [ ] 角色管理（用户、管理员）

### 2. 用户模块 (User Module)
- [ ] 用户注册
- [ ] 用户登录
- [ ] 用户信息管理
- [ ] 地址簿管理
- [ ] 收藏夹功能
- [ ] 用户评价和评论

### 3. 商品模块 (Product Module)
- [ ] 商品管理（后台）
- [ ] 商品分类管理
- [ ] 商品搜索
- [ ] 商品筛选
- [ ] 商品评价
- [ ] 库存管理

### 4. 购物车模块 (Cart Module)
- [ ] 添加到购物车
- [ ] 删除购物车商品
- [ ] 修改数量
- [ ] 价格计算
- [ ] 库存检查

### 5. 订单模块 (Order Module)
- [ ] 订单创建
- [ ] 订单查询
- [ ] 订单状态管理
- [ ] 订单追踪
- [ ] 订单历史

### 6. 支付模块 (Payment Module)
- [ ] Stripe 集成
- [ ] 支付处理
- [ ] 支付状态管理
- [ ] 退款处理
- [ ] 支付历史

### 7. 配送模块 (Shipping Module)
- [ ] 配送方式管理
- [ ] 配送费用计算
- [ ] 配送追踪
- [ ] 配送状态更新

### 8. 退货模块 (Return Module)
- [ ] 退货请求
- [ ] 退货审批
- [ ] 退货追踪
- [ ] 退款处理

## 前端应用

### Storefront (用户端)
```
/
├── Home (首页)
├── Auth (认证)
│   ├── Register (注册)
│   └── Login (登录)
├── Products (商品)
│   ├── List (列表)
│   ├── Detail (详情)
│   └── Search (搜索)
├── Cart (购物车)
├── Checkout (结账)
├── Orders (订单)
│   ├── List (订单列表)
│   └── Detail (订单详情)
└── Account (账户)
    ├── Profile (个人信息)
    ├── Addresses (地址)
    ├── Orders (订单)
    └── Settings (设置)
```

### Admin Dashboard (管理后台)
```
/admin
├── Login (登录)
├── Dashboard (仪表板)
│   ├── 销售统计
│   ├── 订单统计
│   └── 收入统计
├── Products (商品管理)
│   ├── List (商品列表)
│   ├── Create (新增商品)
│   ├── Edit (编辑商品)
│   └── Delete (删除商品)
├── Orders (订单管理)
│   ├── List (订单列表)
│   ├── Detail (订单详情)
│   └── Status (状态管理)
├── Users (用户管理)
│   ├── List (用户列表)
│   └── Detail (用户详情)
├── Inventory (库存管理)
├── Analytics (分析)
│   ├── Sales (销售分析)
│   ├── Traffic (流量分析)
│   └── Revenue (收入分析)
└── Settings (设置)
    ├── General (基本设置)
    ├── Shipping (配送设置)
    └── Payment (支付设置)
```

## 数据库表设计

### 用户相关
- users (用户表)
- user_addresses (用户地址)
- user_favorites (收藏夹)

### 商品相关
- products (商品表)
- product_categories (分类)
- product_images (商品图片)
- product_reviews (商品评价)
- product_inventory (库存)

### 订单相关
- orders (订单表)
- order_items (订单项)
- order_status_history (订单状态历史)

### 支付相关
- payments (支付表)
- payment_methods (支付方式)
- refunds (退款表)

### 配送相关
- shipments (配送表)
- shipping_methods (配送方式)
- shipping_zones (配送地区)

### 退货相关
- returns (退货表)
- return_reasons (退货原因)

## API 端点设计

### 认证 API
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- POST /api/auth/logout - 登出
- POST /api/auth/refresh - 刷新令牌
- POST /api/auth/admin/login - 管理员登录

### 用户 API
- GET /api/users/me - 获取当前用户
- PUT /api/users/me - 更新用户信息
- GET /api/users/addresses - 获取地址列表
- POST /api/users/addresses - 添加地址
- PUT /api/users/addresses/:id - 更新地址
- DELETE /api/users/addresses/:id - 删除地址

### 商品 API
- GET /api/products - 获取商品列表
- GET /api/products/:id - 获取商品详情
- POST /api/products - 创建商品（管理员）
- PUT /api/products/:id - 更新商品（管理员）
- DELETE /api/products/:id - 删除商品（管理员）
- GET /api/products/:id/reviews - 获取评价

### 购物车 API
- GET /api/cart - 获取购物车
- POST /api/cart/items - 添加商品
- PUT /api/cart/items/:id - 更新商品
- DELETE /api/cart/items/:id - 删除商品
- POST /api/cart/checkout - 结账

### 订单 API
- POST /api/orders - 创建订单
- GET /api/orders - 获取订单列表
- GET /api/orders/:id - 获取订单详情
- PUT /api/orders/:id/status - 更新订单状态
- GET /api/orders/:id/tracking - 获取追踪信息

### 支付 API
- POST /api/payments - 创建支付
- GET /api/payments/:id - 获取支付详情
- POST /api/payments/:id/refund - 退款

### 管理员 API
- GET /api/admin/products - 获取商品列表
- POST /api/admin/products - 创建商品
- PUT /api/admin/products/:id - 更新商品
- DELETE /api/admin/products/:id - 删除商品
- GET /api/admin/orders - 获取订单列表
- GET /api/admin/users - 获取用户列表
- GET /api/admin/analytics - 获取分析数据

## 安全考虑

1. **认证**
   - JWT 令牌认证
   - 密码加密存储
   - 会话管理

2. **授权**
   - 角色基访问控制 (RBAC)
   - API 权限验证
   - 数据隔离

3. **数据保护**
   - 环境变量管理
   - 敏感数据加密
   - 输入验证
   - SQL 注入防护

4. **通信安全**
   - HTTPS 加密
   - CORS 配置
   - 速率限制

## 部署架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    Google Cloud Platform                         │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Cloud Load Balancer                    │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    Cloud Run                             │   │
│  │  - Storefront (用户端)                                   │   │
│  │  - Admin Dashboard (管理后台)                            │   │
│  │  - API Gateway                                           │   │
│  │  - 所有微服务                                            │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Cloud SQL                              │   │
│  │  - MySQL 数据库                                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                  Cloud Storage                           │   │
│  │  - 商品图片                                              │   │
│  │  - 用户头像                                              │   │
│  │  - 文件存储                                              │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 开发计划

### 第 1 阶段：后端基础 (1-2 周)
- [ ] Auth Service (认证服务)
- [ ] 更新 User Service 支持用户认证
- [ ] 更新 Product Service 支持后台管理

### 第 2 阶段：前端开发 (2-3 周)
- [ ] Storefront (用户端)
  - 用户注册/登录
  - 商品浏览
  - 购物车和结账
  - 订单管理
  - 用户账户

- [ ] Admin Dashboard (管理后台)
  - 商品管理
  - 订单管理
  - 用户管理
  - 分析统计

### 第 3 阶段：测试和优化 (1 周)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 安全审计

### 第 4 阶段：部署 (1 周)
- [ ] GCP 部署配置
- [ ] 数据库迁移
- [ ] 上线

## 总结

这是一个单商户的电商平台，包括：
- **用户端** - 客户购物
- **管理后台** - 商品和订单管理
- **8 个微服务** - 处理各种业务逻辑
- **完整的支付、配送、退货流程**

相比多商户平台，这个架构更简洁，开发速度更快。
