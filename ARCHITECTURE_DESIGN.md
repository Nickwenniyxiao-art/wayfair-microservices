# Wayfair Clone 完整架构设计

## 系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户端 (Storefront)                        │
│  - 用户注册/登录                                                  │
│  - 浏览商品                                                       │
│  - 搜索和筛选                                                     │
│  - 加入购物车                                                     │
│  - 结账和支付                                                     │
│  - 订单管理                                                       │
│  - 用户账户管理                                                   │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        API Gateway                               │
│  - 请求路由                                                      │
│  - 认证和授权                                                    │
│  - 速率限制                                                      │
│  - 日志记录                                                      │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    后端微服务集群                                 │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ Auth Service │  │ User Service │  │Product Svc   │           │
│  │ - 用户认证   │  │ - 用户管理   │  │ - 商品管理   │           │
│  │ - 登录/注册  │  │ - 地址管理   │  │ - 库存管理   │           │
│  │ - JWT令牌    │  │ - 个人信息   │  │ - 分类管理   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ Cart Service │  │Order Service │  │Payment Svc   │           │
│  │ - 购物车管理 │  │ - 订单创建   │  │ - Stripe集成 │           │
│  │ - 价格计算   │  │ - 订单追踪   │  │ - 支付处理   │           │
│  │ - 库存检查   │  │ - 状态管理   │  │ - 退款处理   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │Shipping Svc  │  │ Return Svc   │  │ Seller Svc   │           │
│  │ - 配送管理   │  │ - 退货管理   │  │ - 商户管理   │           │
│  │ - 费用计算   │  │ - 退款处理   │  │ - 商品发布   │           │
│  │ - 追踪信息   │  │ - 退货追踪   │  │ - 销售统计   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    数据存储层                                     │
│  - MySQL 数据库                                                  │
│  - Redis 缓存                                                    │
│  - S3 文件存储                                                   │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    商户端 (Admin Panel)                           │
│  - 商户注册/登录                                                 │
│  - 商品管理（上传、编辑、删除）                                  │
│  - 库存管理                                                      │
│  - 订单管理                                                      │
│  - 销售统计                                                      │
│  - 收入管理                                                      │
│  - 评价管理                                                      │
└─────────────────────────────────────────────────────────────────┘
```

## 核心模块清单

### 1. 认证和授权 (Authentication & Authorization)
- [ ] 用户注册
- [ ] 用户登录
- [ ] 商户注册
- [ ] 商户登录
- [ ] JWT 令牌管理
- [ ] 权限验证
- [ ] 角色管理（用户、商户、管理员）

### 2. 用户模块 (User Module)
- [ ] 用户注册
- [ ] 用户登录
- [ ] 用户信息管理
- [ ] 地址簿管理
- [ ] 收藏夹功能
- [ ] 用户评价和评论

### 3. 商户模块 (Seller Module)
- [ ] 商户注册
- [ ] 商户认证
- [ ] 商户信息管理
- [ ] 商户等级系统
- [ ] 商户评分

### 4. 商品模块 (Product Module)
- [ ] 商品上传（商户）
- [ ] 商品编辑（商户）
- [ ] 商品删除（商户）
- [ ] 商品分类管理
- [ ] 商品搜索
- [ ] 商品筛选
- [ ] 商品评价

### 5. 购物车模块 (Cart Module)
- [ ] 添加到购物车
- [ ] 删除购物车商品
- [ ] 修改数量
- [ ] 价格计算
- [ ] 库存检查

### 6. 订单模块 (Order Module)
- [ ] 订单创建
- [ ] 订单查询
- [ ] 订单状态管理
- [ ] 订单追踪
- [ ] 订单历史

### 7. 支付模块 (Payment Module)
- [ ] Stripe 集成
- [ ] 支付处理
- [ ] 支付状态管理
- [ ] 退款处理
- [ ] 支付历史

### 8. 配送模块 (Shipping Module)
- [ ] 配送方式管理
- [ ] 配送费用计算
- [ ] 配送追踪
- [ ] 配送状态更新

### 9. 退货模块 (Return Module)
- [ ] 退货请求
- [ ] 退货审批
- [ ] 退货追踪
- [ ] 退款处理

### 10. 后台管理 (Admin Module)
- [ ] 用户管理
- [ ] 商户管理
- [ ] 商品审核
- [ ] 订单管理
- [ ] 支付管理
- [ ] 统计分析

## 前端应用

### Storefront (用户端)
```
/
├── Home (首页)
├── Auth (认证)
│   ├── Register (注册)
│   └── Login (登录)
├── Products (商品)
│   ├── List (列表)
│   ├── Detail (详情)
│   └── Search (搜索)
├── Cart (购物车)
├── Checkout (结账)
├── Orders (订单)
│   ├── List (订单列表)
│   └── Detail (订单详情)
├── Account (账户)
│   ├── Profile (个人信息)
│   ├── Addresses (地址)
│   ├── Orders (订单)
│   └── Settings (设置)
└── Seller (商户入口)
```

### Admin Panel (商户端)
```
/
├── Auth (认证)
│   ├── Register (注册)
│   └── Login (登录)
├── Dashboard (仪表板)
│   ├── 销售统计
│   ├── 订单统计
│   └── 收入统计
├── Products (商品管理)
│   ├── List (商品列表)
│   ├── Create (新增商品)
│   ├── Edit (编辑商品)
│   └── Delete (删除商品)
├── Orders (订单管理)
│   ├── List (订单列表)
│   ├── Detail (订单详情)
│   └── Status (状态管理)
├── Inventory (库存管理)
├── Analytics (分析)
│   ├── Sales (销售分析)
│   ├── Traffic (流量分析)
│   └── Revenue (收入分析)
├── Settings (设置)
│   ├── Profile (商户信息)
│   ├── Bank (银行账户)
│   └── Policies (政策)
└── Support (支持)
```

## 数据库表设计

### 用户相关
- users (用户表)
- user_addresses (用户地址)
- user_favorites (收藏夹)

### 商户相关
- sellers (商户表)
- seller_profiles (商户信息)
- seller_ratings (商户评分)

### 商品相关
- products (商品表)
- product_categories (分类)
- product_images (商品图片)
- product_reviews (商品评价)

### 订单相关
- orders (订单表)
- order_items (订单项)
- order_status_history (订单状态历史)

### 支付相关
- payments (支付表)
- payment_methods (支付方式)
- refunds (退款表)

### 配送相关
- shipments (配送表)
- shipping_methods (配送方式)
- shipping_zones (配送地区)

### 退货相关
- returns (退货表)
- return_reasons (退货原因)

## API 端点设计

### 认证 API
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- POST /api/auth/logout - 登出
- POST /api/auth/refresh - 刷新令牌
- POST /api/auth/seller/register - 商户注册
- POST /api/auth/seller/login - 商户登录

### 用户 API
- GET /api/users/me - 获取当前用户
- PUT /api/users/me - 更新用户信息
- GET /api/users/addresses - 获取地址列表
- POST /api/users/addresses - 添加地址
- PUT /api/users/addresses/:id - 更新地址
- DELETE /api/users/addresses/:id - 删除地址

### 商品 API
- GET /api/products - 获取商品列表
- GET /api/products/:id - 获取商品详情
- POST /api/products - 创建商品（商户）
- PUT /api/products/:id - 更新商品（商户）
- DELETE /api/products/:id - 删除商品（商户）
- GET /api/products/:id/reviews - 获取评价

### 购物车 API
- GET /api/cart - 获取购物车
- POST /api/cart/items - 添加商品
- PUT /api/cart/items/:id - 更新商品
- DELETE /api/cart/items/:id - 删除商品
- POST /api/cart/checkout - 结账

### 订单 API
- POST /api/orders - 创建订单
- GET /api/orders - 获取订单列表
- GET /api/orders/:id - 获取订单详情
- PUT /api/orders/:id/status - 更新订单状态
- GET /api/orders/:id/tracking - 获取追踪信息

### 支付 API
- POST /api/payments - 创建支付
- GET /api/payments/:id - 获取支付详情
- POST /api/payments/:id/refund - 退款

### 商户 API
- GET /api/sellers/me - 获取当前商户
- PUT /api/sellers/me - 更新商户信息
- GET /api/sellers/:id/products - 获取商户商品
- GET /api/sellers/:id/orders - 获取商户订单
- GET /api/sellers/:id/analytics - 获取商户分析

## 安全考虑

1. **认证**
   - JWT 令牌认证
   - 密码加密存储
   - 会话管理

2. **授权**
   - 角色基访问控制 (RBAC)
   - API 权限验证
   - 数据隔离

3. **数据保护**
   - 环境变量管理
   - 敏感数据加密
   - 输入验证
   - SQL 注入防护

4. **通信安全**
   - HTTPS 加密
   - CORS 配置
   - 速率限制

## 部署架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    Google Cloud Platform                         │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Cloud Load Balancer                    │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    Cloud Run                             │   │
│  │  - Storefront (用户端)                                   │   │
│  │  - Admin Panel (商户端)                                  │   │
│  │  - API Gateway                                           │   │
│  │  - 所有微服务                                            │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Cloud SQL                              │   │
│  │  - MySQL 数据库                                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                  Cloud Storage                           │   │
│  │  - 商品图片                                              │   │
│  │  - 用户头像                                              │   │
│  │  - 文件存储                                              │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 开发时间表

- 第 1-2 周：认证和用户模块
- 第 3-4 周：商户和商品模块
- 第 5-6 周：购物车、订单、支付模块
- 第 7-8 周：配送和退货模块
- 第 9-10 周：前端开发（Storefront）
- 第 11-12 周：后端管理（Admin Panel）
- 第 13-14 周：测试和优化
- 第 15-16 周：部署和上线

